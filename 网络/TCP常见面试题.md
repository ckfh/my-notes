# 常见面试题

## TCP头部格式

- 源端口号、目的端口号；
- 序列号；
- 确认应答号；
- 首部长度、保留位、窗口大小；
- 校验和、紧急指针；
- 选项(可变大小)；

其中序列号【用来解决网络包乱序问题】，确认应答号【用来解决不丢包问题】。

## 什么是TCP

TCP是【面向连接】、【可靠的】、【基于字节流】的传输层通信协议。

- 面向连接：一对一；
- 可靠的：无论网络链路出现了怎样的链路变化，TCP都可以保证一个报文一定能够到达接收端；
- 字节流：消息【没有边界】，无论消息多大都可以传输。消息是【有序的】，当【前一个】消息没接收到时，也不会把后面的消息交给上层处理，同时会丢弃【重复】报文。

## 如何唯一确定一个TCP连接以及服务器最大连接数是多少

源地址+源端口+目的地址+目的端口，这四元组唯一确定一个TCP连接。

最大连接数=客户端IP数 X 客户端端口数，但是受到【文件描述符】和【内存】限制。

## TCP和UDP区别

1. 连接
    - TCP面向连接，即传输数据前需要先建立连接。
    - UDP无连接，即刻发送数据。
2. 服务对象
    - TCP仅支持一对一。
    - UDP支持一对一、一对多、多对多。
3. 可靠性
    - TCP可靠交付数据，数据可以无差错、不丢失、不重复、按需到达。
    - UDP尽最大努力交付，不保证可靠交付数据。
4. 拥塞控制、流量控制
    - TCP有这两种机制，保证数据安全性。
    - UDP没有，即使网络拥堵，也不影响UDP的发送速率。
5. 首部开销
    - TCP首部在没有【选项】字段时为20字节，有选项则更长。
    - UDP只有8字节。
6. 传输方式
    - TCP流式传输，无边界，但保证顺序和可靠。
    - UDP一个包一个包发送，有边界，但会丢包和乱序。
7. 分片不同
    - TCP如果大于MSS，则在传输层进行分片，丢失一个分片仅需重传该分片即可。
    - UDP如果大于MTU，则在IP层进行分片，丢失一个分片，在实现【可靠传输】的UDP时就需要重传所有数据包，通常UDP报文应该小于MTU。
8. 应用场景：
    - TCP用于FTP文件传输，HTTP/HTTPS。
    - UDP用于DNS、SNMP，多媒体通信，广播通信。

## 既然IP层会根据MTU分片，为什么传输层还要根据MSS进行分片

MTU：IP头部+IP数据包(TCP头部+TCP数据包)，MAC头部+MTU就是一个完整的MAC包，所以MTU可以理解为是MAC数据包的最大长度。

MSS：TCP数据包的最大长度。

## 如何避免SYN攻击

- 修改内核参数，控制队列大小以及队列满时如何处理
    - 修改半连接、全连接队列大小；
    - 队列慢时对新的SYN包直接回报RST，表示丢弃连接。
- 半连接队列满时，启动cookie(tcp_syncookies)
    - 后续服务器收到SYN包，不进入半连接队列；
    - 计算出一个cookie值，再以SYN+ACK包中的【序列号】返回给客户端；
    - 服务端接收到ACK报文时，验证ACK包合法性，如果合法，放入全连接队列；

## Socket编程listen函数backlog参数意义

在早期Linux中，该参数是半连接队列大小。

内核2.2之后，该参数是全连接队列大小，这是现在通常认为的。

另外，队列大小除了取决于应用程序传递的backlog参数，还取决于内核参数somaxconn的大小，取二者最小值。
