# 底层结构

## SDS

- 牺牲空间换时间；
- 长度操作O(1)；
- 预分配，不会造成缓冲区溢出，修改字符串长度N次“最多”需要N次内存重分配；
- 惰性空间释放；
- 字节数组，保证二进制安全，char[]；
- 保留尾空格是为了重用部分的C库函数；

## 链表

- 空间换时间；
- 双端，前后获取都是常数级别；
- 无环；
- 表头和表尾指针，常数级别获取表头表尾；
- 长度计数器，常数级别获取长度；
- 多态，不限定节点类型；

## 字典

- redis本身就是一个键值数据库，在其基础上它本身也支持字典这一类型；
- 会同时准备两个哈希数组，第一个用于存放键值对，第二个用于rehash时使用；
- 冲突采用拉链法解决，头插法；
- 为了维持负载因子，在扩展和收缩时都需要rehash，扩展，则ht[1].len>=ht[0].used*2的2次幂，收缩，则ht[1].len>=ht[0].used的2次幂；
- rehash后，交换双方的角色；
- 渐进式rehash，防止键值对过多冲爆服务器，使用一个变量从0开始，每次对字典进行操作时，都会将索引为变量处的所有键值对rehash到ht[1]上，然后自增1，直到结束，改为-1；
- 因为是渐进式rehash，因此对字段的操作会先在第一个数组查找，没有再找第二个数组，期间，所有新添加的键值对直接放到ht[1]中。

## 跳表

- 借助冗余节点来换取时间；
- 多数情况下，跳表效率可以和平衡树媲美，并且实现简单；
- sorted set的底层结构；
- 遍历借助前进指针，跨度则用于节点排位；
- 后退指针只能回退到前一个节点；
- 头节点为特殊节点。

## 整数集合

- 集合set键的底层实现之一；
- 整数集合的底层实现为数组，这个数组有序、无重复，有需要时会根据新添加元素类型升级数组的类型。

## 压缩列表

- 节约内存；
- 包含多个节点，每个节点可以保存一个字节数组或一个整数值；
- 添加和删除操作可能引发连锁更新操作。
