# 笔记

## 单线程

Redis服务器执行客户端发送的指令时是串行的，因为它是单线程模型，因此一个客户端在一段时间内发送的多条指令会与其它客户端发送的多条指令串行执行，但是无法保证谁先谁后，因此如果想保证客户端发送的多条指令必须是连续执行的话，就需要使用事务。

Redis单指令为什么是原子性的，因为redis是单线程的，所有指令都是串行执行的。

应该说，redis的单线程保证了单条指令的原子性，但是不保证多条指令的原子性，因为在这其中可能穿插有其它客户端的指令。

## 事务

数据库系统原子性：要么都执行，要么都不执行，中间不会被其它客户端请求所打扰，出现错误将导致回滚。

Redis原子性：要么都执行，要么都不执行，中间不会被其它客户端指令所打扰，出现错误将根据错误的类型确定指令是否执行。

[事务支持](https://redis.io/topics/transactions)

参考官方对于事务的定义以及什么错误会不执行事务，什么错误会执行部分事务，以及为什么不支持回滚。

命令语法出现问题，比如GETSET key value少了value值，那么整个事务都不会执行。

命令语法没有问题，但是操作不正确，比如对一个字符内容的字符串进行INCR key操作，本身命令使用是正确的，但是对字符加一是错误的，因此除了该命令失败以外，其它命令都会执行。

## 基本数据结构

- geo：附近的人；
- hll：统计不重复元素个数，记录网站历史访问用户，不重复，有1%以下的误差；
- bm：适合有两类状态的数据统计，比如上班打卡，到或者没到。因为是用bit作为存储，因此即使是统计14亿人的某个状态也只需要160MB左右的存储空间，而使用bit存储已经是最小的存储单元了，其它常见的存储类型都是以字节为单位的。

## 数据持久化

## 主从复制

### 哨兵机制

## 缓存三问
